# Configuration file for <https://github.com/sapcc/go-makefile-maker>

metadata:
  url: https://github.com/sapcc/maia

binaries:
  - name:        maia
    fromPackage: .
    installTo:   bin/

golang:
  setGoModVersion: true

dockerfile:
  enabled: yes

golangciLint:
  createConfig: true

githubWorkflow:
  ci:
    enabled: true
    coveralls: true

renovate:
  enabled: true
  assignees:
    - notque

# TODO only run `go install` when necessary (cf. golangci-lint installation in the autogenerated "prepare-static-check" target)
# TODO replace go-bindata with <https://pkg.go.dev/embed>
verbatim: |
  ifdef DEBUG
    BINDDATA_FLAGS = -debug
  endif

  build/maia: generate
  static-check: generate

  generate: FORCE
    if ! hash mockgen 2>/dev/null; then go install go.uber.org/mock/mockgen@latest; fi
    if ! hash go-bindata 2>/dev/null; then go install github.com/go-bindata/go-bindata/go-bindata@v3.1.2+incompatible; fi

    mockgen --source pkg/storage/interface.go --destination pkg/storage/genmock.go --package storage
    mockgen --source pkg/keystone/interface.go --destination pkg/keystone/genmock.go --package keystone

    go-bindata $(BINDDATA_FLAGS) -pkg ui -o pkg/ui/bindata.go -ignore '(.*\.map|bootstrap\.js|bootstrap-theme\.css|bootstrap\.css)'  web/templates/... web/static/...
    gofmt -s -w ./pkg/ui/bindata.go
